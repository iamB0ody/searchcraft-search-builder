<ion-header>
  <ion-toolbar color="primary">
    <ion-title>LinkedIn Boolean Search Builder</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-grid>
    <ion-row>
      <!-- Builder Column -->
      <ion-col size="12" size-lg="6">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Search Builder</ion-card-title>
          </ion-card-header>

          <ion-card-content>
            <form [formGroup]="form">
              <!-- Search Type Segment -->
              <ion-segment
                [value]="form.get('searchType')?.value"
                (ionChange)="onSearchTypeChange($event)"
                class="search-type-segment">
                @for (type of searchTypes; track type.value) {
                  <ion-segment-button [value]="type.value">
                    <ion-icon [name]="type.icon"></ion-icon>
                    <ion-label>{{ type.label }}</ion-label>
                  </ion-segment-button>
                }
              </ion-segment>

              <!-- Search Mode Select -->
              <ion-item class="mode-select">
                <ion-select
                  label="Search Mode"
                  labelPlacement="floating"
                  formControlName="mode"
                  interface="popover">
                  @for (mode of searchModes; track mode.value) {
                    <ion-select-option [value]="mode.value">
                      {{ mode.label }}
                    </ion-select-option>
                  }
                </ion-select>
              </ion-item>

              <!-- Titles Input (OR joined) -->
              <app-chip-input
                formControlName="titles"
                label="Job Titles (OR)"
                placeholder="e.g., Software Engineer"
                chipColor="primary"
                helperText="Multiple titles are joined with OR">
              </app-chip-input>

              <!-- Skills Input (AND joined) -->
              <app-chip-input
                formControlName="skills"
                label="Skills (AND)"
                placeholder="e.g., Angular, TypeScript"
                chipColor="secondary"
                helperText="Skills are joined with AND">
              </app-chip-input>

              <!-- Exclude Input (NOT) -->
              <app-chip-input
                formControlName="exclude"
                label="Exclude (NOT)"
                placeholder="e.g., Junior, Intern"
                chipColor="danger"
                helperText="Terms to exclude from results">
              </app-chip-input>

              <!-- Job Filters (for Jobs only) -->
              @if (isJobsSearch) {
                <div class="job-filters-section">
                  <ion-note class="section-label">Job Filters</ion-note>
                  <ion-text color="medium" class="filter-helper">
                    <small>All filters open LinkedIn with URL parameters applied.</small>
                  </ion-text>

                  <!-- Location -->
                  <ion-item class="filter-item">
                    <ion-input
                      label="Location"
                      labelPlacement="floating"
                      formControlName="location"
                      placeholder="e.g., San Francisco, CA">
                    </ion-input>
                  </ion-item>

                  <!-- Sort By -->
                  <ion-item class="filter-item">
                    <ion-select
                      label="Sort By"
                      labelPlacement="floating"
                      formControlName="sortBy"
                      interface="popover">
                      @for (option of sortByOptions; track option.value) {
                        <ion-select-option [value]="option.value">
                          {{ option.label }}
                        </ion-select-option>
                      }
                    </ion-select>
                  </ion-item>

                  <!-- Date Posted -->
                  <ion-item class="filter-item">
                    <ion-select
                      label="Date Posted"
                      labelPlacement="floating"
                      formControlName="datePosted"
                      interface="popover">
                      @for (option of datePostedOptions; track option.value) {
                        <ion-select-option [value]="option.value">
                          {{ option.label }}
                        </ion-select-option>
                      }
                    </ion-select>
                  </ion-item>

                  <!-- Job Type (Multi-select) -->
                  <ion-item class="filter-item">
                    <ion-select
                      label="Job Type"
                      labelPlacement="floating"
                      formControlName="jobTypes"
                      [multiple]="true"
                      interface="popover">
                      @for (option of jobTypeOptions; track option.value) {
                        <ion-select-option [value]="option.value">
                          {{ option.label }}
                        </ion-select-option>
                      }
                    </ion-select>
                  </ion-item>

                  <!-- Experience Level (Multi-select) -->
                  <ion-item class="filter-item">
                    <ion-select
                      label="Experience Level"
                      labelPlacement="floating"
                      formControlName="experienceLevels"
                      [multiple]="true"
                      interface="popover">
                      @for (option of experienceLevelOptions; track option.value) {
                        <ion-select-option [value]="option.value">
                          {{ option.label }}
                        </ion-select-option>
                      }
                    </ion-select>
                  </ion-item>

                  <!-- Work Type (Multi-select) -->
                  <ion-item class="filter-item">
                    <ion-select
                      label="Work Type"
                      labelPlacement="floating"
                      formControlName="workTypes"
                      [multiple]="true"
                      interface="popover">
                      @for (option of workTypeOptions; track option.value) {
                        <ion-select-option [value]="option.value">
                          {{ option.label }}
                        </ion-select-option>
                      }
                    </ion-select>
                  </ion-item>

                  <!-- Easy Apply Toggle -->
                  <ion-item class="filter-item">
                    <ion-label>Easy Apply only</ion-label>
                    <ion-toggle slot="end" formControlName="easyApply"></ion-toggle>
                  </ion-item>

                  <!-- Has Verifications Toggle -->
                  <ion-item class="filter-item">
                    <ion-label>Has verifications</ion-label>
                    <ion-toggle slot="end" formControlName="hasVerifications"></ion-toggle>
                  </ion-item>

                  <!-- Under 10 Applicants Toggle -->
                  <ion-item class="filter-item">
                    <ion-label>Under 10 applicants</ion-label>
                    <ion-toggle slot="end" formControlName="underTenApplicants"></ion-toggle>
                  </ion-item>
                </div>
              }

              <!-- People Filters (for People only) -->
              @if (!isJobsSearch) {
                <div class="people-filters-section">
                  <ion-note class="section-label">People Filters</ion-note>
                  <ion-text color="medium" class="filter-helper">
                    <small>All filters open LinkedIn with URL parameters applied.</small>
                  </ion-text>

                  <!-- Connection Level (Multi-select) -->
                  <ion-item class="filter-item">
                    <ion-select
                      label="Connection Level"
                      labelPlacement="floating"
                      formControlName="connectionLevels"
                      [multiple]="true"
                      interface="popover">
                      @for (option of connectionLevelOptions; track option.value) {
                        <ion-select-option [value]="option.value">
                          {{ option.label }}
                        </ion-select-option>
                      }
                    </ion-select>
                  </ion-item>

                  <!-- Profile Language (Multi-select) -->
                  <ion-item class="filter-item">
                    <ion-select
                      label="Profile Language"
                      labelPlacement="floating"
                      formControlName="profileLanguages"
                      [multiple]="true"
                      interface="popover">
                      @for (option of profileLanguageOptions; track option.value) {
                        <ion-select-option [value]="option.value">
                          {{ option.label }}
                        </ion-select-option>
                      }
                    </ion-select>
                  </ion-item>

                  <!-- First Name -->
                  <ion-item class="filter-item">
                    <ion-input
                      label="First Name"
                      labelPlacement="floating"
                      formControlName="firstName"
                      placeholder="e.g., John">
                    </ion-input>
                  </ion-item>

                  <!-- Last Name -->
                  <ion-item class="filter-item">
                    <ion-input
                      label="Last Name"
                      labelPlacement="floating"
                      formControlName="lastName"
                      placeholder="e.g., Smith">
                    </ion-input>
                  </ion-item>

                  <!-- Title -->
                  <ion-item class="filter-item">
                    <ion-input
                      label="Title"
                      labelPlacement="floating"
                      formControlName="keywordTitle"
                      placeholder="e.g., Software Engineer">
                    </ion-input>
                  </ion-item>

                  <!-- Company -->
                  <ion-item class="filter-item">
                    <ion-input
                      label="Company"
                      labelPlacement="floating"
                      formControlName="keywordCompany"
                      placeholder="e.g., Google">
                    </ion-input>
                  </ion-item>

                  <!-- School -->
                  <ion-item class="filter-item">
                    <ion-input
                      label="School"
                      labelPlacement="floating"
                      formControlName="keywordSchool"
                      placeholder="e.g., Stanford University">
                    </ion-input>
                  </ion-item>
                </div>
              }

              <!-- Clear Button -->
              <ion-button
                expand="block"
                fill="outline"
                color="medium"
                (click)="clearForm()"
                class="clear-button">
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                Clear All
              </ion-button>
            </form>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- Preview Column -->
      <ion-col size="12" size-lg="6">
        <app-preview
          [booleanQuery]="booleanQuery"
          [searchUrl]="searchUrl"
          [warnings]="warnings"
          [operatorCount]="operatorCount"
          [badgeStatus]="badgeStatus">
        </app-preview>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
