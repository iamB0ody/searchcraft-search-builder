<ion-card>
  <ion-card-header>
    <ion-card-title>
      Search Preview
      <ion-badge [color]="booleanLevelColor" class="boolean-level-badge">
        {{ booleanLevelLabel }}
      </ion-badge>
      @if (operatorCount > 0) {
        <ion-badge [color]="badgeColor" class="operator-badge">
          {{ operatorCount }} operators
        </ion-badge>
      }
    </ion-card-title>
  </ion-card-header>

  <ion-card-content>
    <!-- Quality Score Badge -->
    @if (qualityScore) {
      <div class="quality-score">
        <ion-badge [color]="scoreColor" class="score-badge">
          {{ qualityScore.score }} - {{ scoreLabel }}
        </ion-badge>

        @if (qualityScore.reasons.length > 0) {
          <div class="quality-reasons">
            @for (reason of qualityScore.reasons; track reason.message) {
              <div class="reason" [class.warning]="reason.type === 'warning'">
                <ion-icon [name]="reason.type === 'warning' ? 'alert-circle-outline' : 'information-circle-outline'"
                          [color]="reason.type === 'warning' ? 'warning' : 'medium'">
                </ion-icon>
                <span>{{ reason.message }}</span>
              </div>
            }
          </div>
        }
      </div>
    }

    <!-- Emotional Mode Badge (when not normal) -->
    @if (showEmotionalModeBadge) {
      <div class="emotional-mode-badge">
        <ion-badge [color]="emotionalModeColor">
          {{ emotionalModeConfig[emotionalMode].icon }} {{ emotionalModeConfig[emotionalMode].label }} Mode
        </ion-badge>
        <ion-text color="medium" class="mode-description">
          <small>{{ emotionalModeConfig[emotionalMode].description }}</small>
        </ion-text>
      </div>
    }

    <!-- Hiring Signals Badge -->
    @if (showHiringSignalsBadge) {
      <div class="hiring-signals-badge">
        <ion-badge color="tertiary">
          Hiring Signals: {{ hiringSignalsCount }} active
        </ion-badge>

        <ion-accordion-group class="signals-detail-accordion">
          <ion-accordion value="signals-detail">
            <ion-item slot="header" lines="none" class="signals-detail-header">
              <ion-label color="medium">
                <small>View injected phrases</small>
              </ion-label>
            </ion-item>
            <div slot="content" class="signals-detail-content">
              @if (hiringSignalsExplanation?.injectedIncludes?.length) {
                <div class="phrase-group">
                  <strong>Added phrases:</strong>
                  <div class="phrase-chips">
                    @for (phrase of hiringSignalsExplanation?.injectedIncludes; track phrase) {
                      <ion-chip size="small" color="success">{{ phrase }}</ion-chip>
                    }
                  </div>
                </div>
              }
              @if (hiringSignalsExplanation?.injectedExcludes?.length) {
                <div class="phrase-group">
                  <strong>Excluded:</strong>
                  <div class="phrase-chips">
                    @for (phrase of hiringSignalsExplanation?.injectedExcludes; track phrase) {
                      <ion-chip size="small" color="danger">{{ phrase }}</ion-chip>
                    }
                  </div>
                </div>
              }
              <ion-text color="medium" class="signals-disclaimer">
                <small>Signals are based on profile text patterns; results may vary.</small>
              </ion-text>
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </div>
    }

    <!-- People Location Badge -->
    @if (showLocationBadge) {
      <div class="location-badge">
        <ion-badge color="tertiary">
          Location: {{ peopleLocation }}
        </ion-badge>
        <ion-text color="medium">
          <small>Applied as keyword in query</small>
        </ion-text>
      </div>
    }

    <!-- LinkedIn Jobs Filters Badge -->
    @if (showLinkedInJobsFilters) {
      <div class="linkedin-jobs-filters-badge">
        @if (linkedInJobsFilters?.datePosted && linkedInJobsFilters?.datePosted !== 'any') {
          <ion-chip size="small" color="primary">
            Date: {{ datePostedLabel }}
          </ion-chip>
        }
        @if (linkedInJobsFilters?.inYourNetwork) {
          <ion-chip size="small" color="tertiary">
            In Network: On
          </ion-chip>
        }
        @if (linkedInJobsFilters?.fairChanceEmployer) {
          <ion-chip size="small" color="tertiary">
            Fair Chance: On
          </ion-chip>
        }
      </div>
    }

    <!-- Warnings -->
    @if (warnings.length > 0) {
      <ion-list class="warnings-list" lines="none">
        @for (warn of warnings; track warn) {
          <ion-item [color]="getWarningColor(warn)">
            <ion-icon name="warning" slot="start"></ion-icon>
            <ion-label class="ion-text-wrap">{{ warn }}</ion-label>
          </ion-item>
        }
      </ion-list>
    }

    <!-- Boolean Query Section -->
    <div class="preview-section">
      <ion-text color="medium">
        <h4>Boolean Query</h4>
      </ion-text>
      <pre class="query-display" [class.empty]="!booleanQuery">{{ booleanQuery || 'Enter search criteria above to generate query' }}</pre>
    </div>

    <!-- URL Section -->
    <div class="preview-section">
      <ion-text color="medium">
        <h4>{{ platformLabel }} URL</h4>
      </ion-text>
      <pre class="url-display" [class.empty]="!searchUrl">{{ searchUrl || 'URL will appear here' }}</pre>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <ion-button
        expand="block"
        color="primary"
        (click)="openInLinkedIn()"
        [disabled]="!searchUrl">
        <ion-icon [name]="platformIcon" slot="start"></ion-icon>
        Open in {{ platformLabel }}
      </ion-button>

      <ion-button
        expand="block"
        fill="outline"
        color="medium"
        (click)="copyQuery()"
        [disabled]="!booleanQuery">
        <ion-icon name="copy" slot="start"></ion-icon>
        Copy Query
      </ion-button>

      <ion-button
        expand="block"
        fill="outline"
        color="medium"
        (click)="copyUrl()"
        [disabled]="!searchUrl">
        <ion-icon name="copy" slot="start"></ion-icon>
        Copy URL
      </ion-button>

      <ion-button
        expand="block"
        fill="outline"
        color="tertiary"
        (click)="shareSearch.emit()"
        [disabled]="!booleanQuery">
        <ion-icon name="share-social-outline" slot="start"></ion-icon>
        Share Search
      </ion-button>
    </div>
  </ion-card-content>
</ion-card>
